metadata:
  version: "2.0"
  project: "litestar-fullstack-spa"
  adaptive: true
  description: "Quality gates adapted to litestar-fullstack-spa conventions"

implementation_gates:
  - name: tests_pass
    command: "make test"
    required: true
    description: "All tests must pass before proceeding"

  - name: linting_clean
    command: "make lint"
    required: true
    description: "Zero linting errors (ruff + biome)"

  - name: type_checking_pass
    command: "make check-all"
    required: true
    description: "Type checking (mypy) must pass"

  - name: types_generated
    command: "make types"
    applicable_when: "schema_changes"
    required: true
    description: "Run after backend schema changes to generate TypeScript client"

testing_gates:
  - name: coverage_threshold
    threshold: 90
    scope: "modified_modules"
    adaptive: true
    description: "Modified modules must achieve 90%+ coverage"

  - name: test_isolation
    required: true
    description: "Tests must work in parallel execution (pytest-xdist)"

  - name: async_tests
    type: "pattern"
    required: true
    description: "Async tests must use @pytest.mark.asyncio"

documentation_gates:
  - name: anti_pattern_scan
    adaptive: true
    rules:
      - pattern: "Optional\\["
        severity: "error"
        message: "Use T | None (PEP 604) instead of Optional[T]"

      - pattern: "class Test"
        severity: "warning"
        message: "Prefer function-based tests per project guidelines"

      - pattern: "from pydantic import"
        severity: "warning"
        message: "Use msgspec.Struct for API DTOs, not Pydantic"
        applicable_in: ["schemas/", "domain/"]

      - pattern: "dict\\["
        severity: "warning"
        message: "Use msgspec.Struct for API responses, not raw dicts"
        applicable_in: ["controllers/"]

  - name: pattern_compliance
    description: "Follow service/repository pattern from existing code"
    required: true

workflow_gates:
  - name: pre_commit
    commands:
      - "make lint"
      - "make test"
    description: "Run before every commit"

  - name: pre_push
    commands:
      - "make check-all"
    description: "Run before pushing to remote"
