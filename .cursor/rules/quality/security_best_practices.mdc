---
description:
globs:
alwaysApply: false
---
# Security Best Practices

## Objective
To ensure the application is developed with security in mind, protecting against common vulnerabilities.

## Context
- Web application with Python backend (Litestar) and JavaScript/TypeScript frontend.
- Data storage via SQLAlchemy, user authentication, external API integrations.
- **Data Validation**: `msgspec.Struct` is used for all API input validation (see `.cursor/rules/domain/data_validation.mdc`).

## Rules

### Input Validation
- Validate all incoming data (API requests, user inputs) using `msgspec.Struct` on the backend and appropriate form validation on the frontend.
- Sanitize outputs to prevent XSS (though modern frontend frameworks often handle this by default, e.g., React).

### Authentication & Authorization
- Implement strong password policies, secure session/token management (JWT).
- Enforce proper authorization using guards (backend) and conditional UI rendering (frontend).
- See also: `.cursor/rules/domain/auth_and_users.mdc`

### Dependency Management
- Regularly update dependencies to patch known vulnerabilities (`uv lock --upgrade`, `npm upgrade`).
- Use tools to scan for vulnerable dependencies (e.g., `pip-audit`, `npm audit`, GitHub Dependabot).

### Data Handling
- Protect sensitive data (encryption at rest/transit where appropriate for PII, financial data, etc.).
- Avoid logging sensitive information unless absolutely necessary and properly secured/masked.

### API Security
- Use HTTPS for all communication.
- Implement rate limiting and protection against common API attacks (e.g., via API gateway or middleware in Litestar).
- Ensure proper CORS configuration.

### Docker & Deployment
- Use minimal base images for Docker.
- Do not hardcode secrets in Dockerfiles or source code; use environment variables or dedicated secret management tools.
- Scan Docker images for vulnerabilities.

### Secure Headers
- Implement security-related HTTP headers (e.g., `Content-Security-Policy`, `Strict-Transport-Security`, `X-Content-Type-Options`).

## Exceptions
- Local development environments might have relaxed security for ease of debugging (e.g., more permissive CORS, simpler HTTPS setup), but production configurations must be strict.
