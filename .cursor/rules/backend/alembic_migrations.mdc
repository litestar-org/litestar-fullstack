---
description:
globs:
alwaysApply: false
---
# Alembic Migration Conventions

## Objective
To ensure database migrations are safe, reversible, and maintainable.

## Context
- Alembic, SQLAlchemy, Advanced Alchemy.
- Migrations managed via `app database` CLI commands.

## Rules

### Migration Generation
- Generate migrations using `app database make-migrations -m "Descriptive message"`.
- Always review auto-generated migrations carefully.

### Migration Content
- Ensure `upgrade()` and `downgrade()` functions are symmetrical.
- For data migrations, provide clear downgrade paths or state they are irreversible if necessary.
- Use `op.bulk_insert()` for large data additions.

### Best Practices
- Keep migrations small and focused on a single schema change or data transformation.
- Test migrations in a development/staging environment before applying to production.

## Exceptions
- Initial database schema setup might be a larger migration.
